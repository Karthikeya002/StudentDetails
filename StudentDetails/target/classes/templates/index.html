<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Student Details</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Bootstrap CSS -->
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
    />
</head>
<body class="bg-light">
<div class="container py-4">
    <h1 class="mb-4">Student Details</h1>

    <!-- Alerts -->
    <div id="alertBox" class="alert d-none" role="alert"></div>

    <!-- Controls -->
    <div class="row g-3">
        <!-- Load All -->
        <div class="col-12 col-md-3">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">All Students</h5>
                    <button id="btnLoadAll" class="btn btn-primary w-100">Load All</button>
                </div>
            </div>
        </div>

        <!-- Get By ID -->
        <div class="col-12 col-md-3">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Get Student By ID</h5>
                    <div class="input-group mb-2">
                        <input type="number" id="studentId" class="form-control" placeholder="Enter ID" />
                        <button id="btnGetById" class="btn btn-outline-secondary">Get</button>
                    </div>
                    <pre id="byIdOutput" class="small mb-0 text-muted"></pre>
                </div>
            </div>
        </div>

        <!-- Add Student -->
        <div class="col-12 col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Add Student</h5>
                    <form id="addForm">
                        <div class="row g-2">
                            <div class="col-md-5">
                                <input id="name" class="form-control" placeholder="Name" required />
                            </div>
                            <div class="col-md-5">
                                <input id="email" type="email" class="form-control" placeholder="Email" required />
                            </div>
                            <div class="col-md-2 d-grid">
                                <button class="btn btn-success" type="submit">Add</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Table -->
    <div class="card mt-4 shadow-sm">
        <div class="card-body">
            <h5 class="card-title">Students List</h5>
            <div class="table-responsive">
                <table class="table table-striped table-hover align-middle" id="studentsTable">
                    <thead class="table-dark">
                    <tr>
                        <th style="width: 80px;">ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th style="width: 120px;">Action</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- filled by JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <footer class="text-center text-muted mt-4 small">
        Powered by Spring Boot REST API
    </footer>
</div>

<script>
    const API_BASE = "/api/students";

    const alertBox = document.getElementById("alertBox");
    const studentsTableBody = document.querySelector("#studentsTable tbody");
    const byIdOutput = document.getElementById("byIdOutput");

    function showAlert(message, type = "info") {
        alertBox.className = `alert alert-${type}`;
        alertBox.textContent = message;
        alertBox.classList.remove("d-none");
        setTimeout(() => alertBox.classList.add("d-none"), 3000);
    }

    function clearTable() {
        studentsTableBody.innerHTML = "";
    }

    function addRow(s) {
        const tr = document.createElement("tr");
        tr.innerHTML = `
        <td>${s.id ?? ""}</td>
        <td>${s.name ?? ""}</td>
        <td>${s.email ?? ""}</td>
        <td>
          <button class="btn btn-sm btn-danger" onclick="deleteStudent(${s.id})">Delete</button>
        </td>
      `;
        studentsTableBody.appendChild(tr);
    }

    // Load all students
    async function loadAll() {
        clearTable();
        byIdOutput.textContent = "";
        try {
            const res = await fetch(`${API_BASE}/all`);
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            const data = await res.json();
            if (Array.isArray(data) && data.length) {
                data.forEach(addRow);
                showAlert(`Loaded ${data.length} student(s).`, "success");
            } else {
                showAlert("No students found.", "warning");
            }
        } catch (err) {
            showAlert(`Failed to load students: ${err.message}`, "danger");
        }
    }

    // Get by ID
    async function getById(id) {
        byIdOutput.textContent = "";
        try {
            const res = await fetch(`${API_BASE}/${id}`);
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            const data = await res.json();
            if (data && (data.id !== null && data.id !== undefined)) {
                byIdOutput.textContent = JSON.stringify(data, null, 2);
                showAlert(`Fetched student ID ${id}.`, "success");
            } else {
                byIdOutput.textContent = "Not found";
                showAlert("Student not found.", "warning");
            }
        } catch (err) {
            showAlert(`Failed to fetch student: ${err.message}`, "danger");
        }
    }

    // Add student
    async function addStudent(payload) {
        try {
            const res = await fetch(`${API_BASE}/add`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
            });
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            const data = await res.json();
            showAlert(`Added student (ID: ${data.id}).`, "success");
            loadAll();
        } catch (err) {
            showAlert(`Failed to add student: ${err.message}`, "danger");
        }
    }

    // Delete student
    async function deleteStudent(id) {
        if (!confirm(`Delete student with ID ${id}?`)) return;
        try {
            const res = await fetch(`${API_BASE}/${id}`, { method: "DELETE" });
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            showAlert(`Deleted student ID ${id}.`, "success");
            loadAll();
        } catch (err) {
            showAlert(`Failed to delete student: ${err.message}`, "danger");
        }
    }

    // Event bindings
    document.getElementById("btnLoadAll").addEventListener("click", loadAll);

    document.getElementById("btnGetById").addEventListener("click", () => {
        const id = document.getElementById("studentId").value.trim();
        if (!id) return showAlert("Please enter an ID.", "warning");
        getById(id);
    });

    document.getElementById("addForm").addEventListener("submit", (e) => {
        e.preventDefault();
        const name = document.getElementById("name").value.trim();
        const email = document.getElementById("email").value.trim();
        if (!name || !email) return showAlert("Name and Email are required.", "warning");
        addStudent({ name, email });
        e.target.reset();
    });

    // Auto-load on page open
    loadAll();
</script>
</body>
</html>
